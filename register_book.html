<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt Mua Kỷ Yếu Hội Thảo VCFe 2025</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
            color: #333;
        }
        .main-card {
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            border: none;
            overflow: hidden;
        }
        .book-info-col {
            padding: 2.5rem;
        }
        .form-col {
            padding: 2.5rem;
            background-color: #fafbfc;
            border-left: 1px solid #eef2f6;
        }
        .book-cover {
            border-radius: 8px;
            max-width: 300px;
            margin: 0 auto 2rem auto;
            display: block;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .book-title {
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 1rem;
        }
        .book-description {
            color: #555;
            line-height: 1.6;
        }
        .features-list {
            list-style: none;
            padding-left: 0;
            margin-top: 1.5rem;
        }
        .features-list li {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            color: #444;
        }
        .features-list .fa-check-circle {
            color: #28a745;
            margin-right: 0.75rem;
            margin-top: 4px;
        }
        .specs p {
            margin-bottom: 0.5rem;
            color: #555;
        }
        .specs strong {
            color: #333;
        }
        .form-title {
            font-weight: 600;
            color: #1a202c;
        }
        .form-control {
            height: 48px;
            border-color: #e2e8f0;
        }
        .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.2);
        }
        .btn-submit {
            background-color: #0d6efd;
            border-color: #0d6efd;
            font-weight: 500;
            padding: 12px;
        }
        .success-card {
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body>
    <!-- Notification Container -->
    <div id="notification-container" class="position-fixed top-0 end-0 p-3" style="z-index: 1150"></div>

    <!-- Main Content -->
    <div class="container my-5">
        <!-- Order Page -->
        <div id="order-page" class="page active">
            <div class="card main-card">
                <div class="row g-0">
                    <!-- Left Column: Book Info -->
                    <div class="col-lg-6 book-info-col">
                        <img src="https://lh3.googleusercontent.com/BxRNSLEenedtHgbQXEc0WkR-YzJXWFo-emOAn-7el1kxHtwFBQETTcQhcOXoboUHDTYttKzI0Afre1RvJd5TfVzacSpVgIoiBg=rw-w461" class="book-cover" alt="Bìa Kỷ yếu VCFe 2025">
                        <h2 class="book-title">KỶ YẾU HỘI THẢO VCFe 2025</h2>
                        <p class="book-description">
                            Kỷ yếu hội thảo VCFe 2025 là tài liệu tổng hợp các bài nghiên cứu, báo cáo khoa học và kết quả thảo luận từ Hội thảo Kinh tế Tài chính Việt Nam 2025.
                        </p>
                        
                        <h5 class="mt-4" style="font-weight: 600;">Nội dung chính:</h5>
                        <ul class="features-list">
                            <li><i class="fas fa-check-circle"></i>Các báo cáo khoa học chất lượng cao</li>
                            <li><i class="fas fa-check-circle"></i>Phân tích chuyên sâu về tài chính xanh</li>
                            <li><i class="fas fa-check-circle"></i>Giải pháp đổi mới cho tăng trưởng bền vững</li>
                            <li><i class="fas fa-check-circle"></i>Hơn 30 bài viết từ các chuyên gia hàng đầu</li>
                        </ul>

                        <div class="specs mt-4">
                            <p><strong>Số trang:</strong> Khoảng 300 trang</p>
                            <p><strong>Kích thước:</strong> 21 x 29.7 cm (A4)</p>
                            <p><strong>Ngôn ngữ:</strong> Tiếng Việt (có tóm tắt tiếng Anh)</p>
                            <p><strong>Phát hành:</strong> Tháng 7/2025</p>
                            <p><strong>Giá:</strong> 250.000 VNĐ / cuốn</p>
                        </div>
                    </div>

                    <!-- Right Column: Order Form -->
                    <div class="col-lg-6 form-col d-flex flex-column justify-content-center">
                        <h3 class="form-title mb-2">ĐĂNG KÝ NHẬN KỶ YẾU</h3>
                        <p class="text-muted mb-4">Vui lòng điền thông tin để đặt trước.</p>
                        <form id="orderForm">
                            <div class="mb-3">
                                <label for="name" class="form-label fw-medium">Họ và tên</label>
                                <input type="text" class="form-control" id="name" required>
                            </div>
                            <div class="mb-3">
                                <label for="phone" class="form-label fw-medium">Số điện thoại</label>
                                <input type="tel" class="form-control" id="phone" required>
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label fw-medium">Email</label>
                                <input type="email" class="form-control" id="email">
                            </div>
                            <div class="mb-3">
                                <label for="quantity" class="form-label fw-medium">Số lượng đặt</label>
                                <input type="number" class="form-control" id="quantity" value="1" min="1" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 py-2 mt-3 btn-submit">
                                <i class="fas fa-paper-plane me-2"></i>XÁC NHẬN ĐẶT MUA
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Page -->
        <div id="success-page" class="page text-center" style="display: none;">
            <div class="row justify-content-center">
                <div class="col-md-7">
                    <div class="card p-5 success-card">
                        <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                        <h2>Đặt Mua Thành Công!</h2>
                        <p class="lead text-muted">Cảm ơn bạn đã đặt mua kỷ yếu. Chúng tôi đã ghi nhận thông tin của bạn:</p>
                        <div id="orderDetails" class="alert alert-light border"></div>
                        <button class="btn btn-outline-primary mt-3" onclick="window.location.reload()">
                            <i class="fas fa-plus me-2"></i>Đặt Đơn Hàng Mới
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://daavpmtwlarsmwyhjxeg.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhYXZwbXR3bGFyc213eWhqeGVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwMzE4ODIsImV4cCI6MjA2NDYwNzg4Mn0.mGu2KMRzAOg2L7h4AU8eFaZlzJLD57W5vsGd_eGDeFk';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notification-container');
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0 show`;
            toast.innerHTML = `<div class="d-flex"><div class="toast-body">${message}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), duration);
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
            document.getElementById(pageId).style.display = 'block';
        }

        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang xử lý...';

            try {
                const phone = document.getElementById('phone').value.trim();
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value || null;
                const quantity = parseInt(document.getElementById('quantity').value, 10);

                if (!name || !phone || !quantity || quantity < 1) {
                    showNotification('Vui lòng điền đầy đủ thông tin bắt buộc.', 'warning');
                    return;
                }

                const { data: existingOrder, error: checkError } = await supabase
                    .from('yearbook_orders')
                    .select('id, name')
                    .eq('phone', phone)
                    .single();

                if (checkError && checkError.code !== 'PGRST116') throw checkError;

                if (existingOrder) {
                    showNotification(`Số điện thoại ${phone} đã được dùng để đặt hàng cho "${existingOrder.name}".`, 'warning');
                    return;
                }

                const payload = { 
                    name, phone, email, quantity, 
                    order_time: new Date().toISOString(),
                    status: 'Chưa giao'
                };

                const { data: insertedData, error: insertError } = await supabase
                    .from('yearbook_orders')
                    .insert([payload])
                    .select();

                if (insertError) throw insertError;
                
                showNotification('Đặt hàng thành công!', 'success');
                document.getElementById('orderDetails').innerHTML = `
                    <strong>Họ tên:</strong> ${insertedData[0].name}<br>
                    <strong>Điện thoại:</strong> ${insertedData[0].phone}<br>
                    <strong>Số lượng:</strong> ${insertedData[0].quantity} cuốn
                `;
                showPage('success-page');

            } catch (error) {
                console.error('Order Error:', error);
                showNotification(`Lỗi đặt hàng: ${error.message}`, 'danger');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>XÁC NHẬN ĐẶT MUA';
            }
        });
    </script>
</body>
</html>